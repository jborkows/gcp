rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /notes/{document} {
      allow read,write: if isAppUser();
    }
    match /PeriodicTask/{document} {
      allow write: if (hasRole("writer") || hasRole("admin"))
      allow read: if isAppUser();
    }
    match /{document=**} {
      allow read, write: if false;
    }
  }

  function hasRole(role){
    let userRoles = request.auth.token.userRoles;
    return role in userRoles
  }

  function isAppUser(){
    return hasRole("writer") || hasRole("admin") || hasRole("reader")
    // return  request.auth.token.appUser == true;

  }
  function existingData(){
    return resource.data
  }

  function incomingData(){
    return request.resource.data
  }
}