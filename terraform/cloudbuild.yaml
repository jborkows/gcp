steps:
- name: 'bash'
  id: 'echo'
  args: ['echo', '$PROJECT_ID']  
- name: snyk/snyk-cli:1.864.0-docker
  args: 
     - '-c'
     - |-
        SNYK_TOKEN=$$SNYK_T snyk iac test main.tf
  dir: 'terraform'      
  secretEnv: ['SNYK_T']
- id: "init"
  name: 'gcr.io/$PROJECT_ID/terraformbuild:0.1'
  args: ['init']
  dir: 'terraform'
- id: "plan"
  name: 'gcr.io/$PROJECT_ID/terraformbuild:0.1'
  args: ['apply','-var=project_id=$PROJECT_ID','-auto-approve']
  dir: 'terraform'
options:
  logging: CLOUD_LOGGING_ONLY
availableSecrets:
  secretManager:
  - versionName: projects/$PROJECT_ID/secrets/snyk-token/versions/1
    env: 'SNYK_T'
